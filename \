import pandas as pd
import numpy as np


USERS = 'users.csv'
LOCATIONS = 'locations.csv'
ROLE_DELIMITER = '###'
SEP = '\t'


def add_user(name, ID):
    _add_to_csv(USERS, [name, ID], 'Name')


def add_location(location, roles=[]):
    _add_to_csv(LOCATIONS, [location, ROLE_DELIMITER.join(roles)], 'Location')

def _add_to_csv(path, row, key):
    old_dataframe = pd.read_csv(path, sep=SEP)
    keys = old_dataframe[key].values.reshape(-1)

    if row[0] not in keys:
        pd.DataFrame([row]).to_csv(path, sep=SEP, mode='a',
                                   index=False, header=False)
    else:
        matches = np.where(keys == row[0])[0]
        old_dataframe.drop(matches, inplace=True)
        old_dataframe.append(row)
        old_dataframe.to_csv(path, sep=SEP, index=False, mode='w')
